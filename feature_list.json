{
  "project_name": "medsync",
  "description": "Projeto app mobile e web para gerenciamento de escalas médicas",
  "tech_stack": [
    "TypeScript",
    "React",
    "Supabase",
    "React Hook Form",
    "Zod",
    "date-fns",
    "Next.js 16",
    "Tailwind CSS 4",
    "shadcn/ui",
    "Radix UI",
    "TanStack React Query",
    "Recharts",
    "Leaflet",
    "React Big Calendar",
    "Lucide React",
    "next-themes",
    "React Native",
    "Expo SDK 54",
    "Expo Router",
    "React Navigation",
    "React Native Reanimated",
    "React Native Calendars",
    "Lottie",
    "Expo Image Picker",
    "Expo Notifications",
    "Expo Secure Store"
  ],
  "features": [
    {
      "id": "F001",
      "title": "Create especialidades table in Supabase with seed data",
      "type": "refactoring",
      "description": "Create new 'especialidades' table in Supabase with columns: id (uuid, primary key), nome (text, unique, not null), created_at (timestamp). Create migration file that includes table creation, RLS policies for public read access, and seed data with common medical specialties (Cardiologia, Dermatologia, Ortopedia, Pediatria, Ginecologia, Oftalmologia, etc.). Enable RLS and set appropriate permissions.",
      "acceptance_criteria": [
        "Migration file created in migrations/ directory",
        "Table 'especialidades' created with id, nome, created_at columns",
        "RLS enabled with policy allowing public SELECT access",
        "At least 15 common medical specialties seeded in the table",
        "Migration executed successfully in Supabase"
      ],
      "passes": true
    },
    {
      "id": "F002",
      "title": "Analyze and migrate existing corpo_clinico specialty data",
      "type": "refactoring",
      "description": "Query existing corpo_clinico table to extract all unique specialty values from the string field. Analyze the data to identify duplicates, variations, and typos. Create data migration script that: 1) maps existing string values to especialidades table IDs, 2) adds new column 'especialidade_id' (uuid, foreign key to especialidades) to corpo_clinico, 3) populates especialidade_id based on string matching, 4) handles edge cases and unmapped values by creating new entries in especialidades table.",
      "acceptance_criteria": [
        "Data analysis script created that lists all unique specialty values",
        "Migration script handles string-to-ID mapping with fuzzy matching for typos",
        "New column 'especialidade_id' added to corpo_clinico with foreign key constraint",
        "All existing records successfully migrated to use especialidade_id",
        "Migration script logs any unmapped or ambiguous values for manual review"
      ],
      "passes": true
    },
    {
      "id": "F003",
      "title": "Update TypeScript types and Zod schemas for especialidade refactor",
      "type": "refactoring",
      "description": "Update shared TypeScript types in packages/shared/src to include Especialidade type with id and nome fields. Update CorpoClinico type to change especialidade from string to especialidade_id (uuid) and add nested especialidade object. Create Zod schemas for especialidade validation. Update form schemas in both web and mobile apps to validate especialidade_id instead of free text. Generate TypeScript types from Supabase schema using supabase gen types.",
      "acceptance_criteria": [
        "Especialidade type defined in packages/shared/src/types",
        "CorpoClinico type updated with especialidade_id and nested especialidade",
        "Zod schemas created for especialidade validation",
        "Form schemas in web and mobile updated to use especialidade_id",
        "TypeScript types generated from updated Supabase schema"
      ],
      "passes": true
    },
    {
      "id": "F004",
      "title": "Create useEspecialidades hook with React Query",
      "type": "refactoring",
      "description": "Create shared hook useEspecialidades in packages/shared/src/hooks that fetches especialidades from Supabase using React Query. Implement caching with staleTime of 1 hour (data rarely changes). Include error handling, loading states, and retry logic. Export hook for use in both web and mobile apps. Add optional search/filter functionality to find especialidades by name.",
      "acceptance_criteria": [
        "useEspecialidades hook created in packages/shared/src/hooks",
        "React Query used with appropriate caching configuration (staleTime: 1 hour)",
        "Hook returns { data, isLoading, error, refetch } interface",
        "Error handling and retry logic implemented",
        "Optional search parameter implemented for filtering by name"
      ],
      "passes": true
    },
    {
      "id": "F005",
      "title": "Refactor web app corpo clinico forms to use Select component",
      "type": "refactoring",
      "description": "Update corpo clinico create/edit forms in apps/web to replace text input with shadcn/ui Select component. Integrate useEspecialidades hook to populate Select options. Update React Hook Form field from 'especialidade' string to 'especialidade_id' uuid. Implement search/filter functionality in Select for better UX with many options. Ensure proper validation and error messages. Update form submission to send especialidade_id to API.",
      "acceptance_criteria": [
        "Text input replaced with shadcn/ui Select component in create form",
        "Text input replaced with shadcn/ui Select component in edit form",
        "useEspecialidades hook integrated to fetch and populate options",
        "Select component includes search/filter functionality",
        "Form validation updated to require especialidade_id selection",
        "Form submission successfully sends especialidade_id to backend"
      ],
      "passes": true
    },
    {
      "id": "F006",
      "title": "Refactor mobile app corpo clinico forms to use Picker component",
      "type": "refactoring",
      "description": "Update corpo clinico create/edit screens in apps/mobile to replace TextInput with React Native Picker or custom dropdown component. Integrate useEspecialidades hook to populate Picker options. Update form field from 'especialidade' string to 'especialidade_id' uuid. Implement platform-appropriate UI (iOS action sheet, Android dropdown). Ensure proper validation and error messages. Update form submission to send especialidade_id.",
      "acceptance_criteria": [
        "TextInput replaced with appropriate Picker/dropdown in create screen",
        "TextInput replaced with appropriate Picker/dropdown in edit screen",
        "useEspecialidades hook integrated to fetch and populate options",
        "Platform-appropriate UI implemented (iOS/Android)",
        "Form validation updated to require especialidade_id selection",
        "Form submission successfully sends especialidade_id to backend"
      ],
      "passes": true
    },
    {
      "id": "F007",
      "title": "Update all display views to show especialidade.nome via join",
      "type": "refactoring",
      "description": "Update all Supabase queries that fetch corpo_clinico records to include .select('*, especialidade:especialidade_id(id, nome)') to join especialidades table. Update display components in both web (tables, cards, detail views) and mobile (lists, cards, profile screens) to render especialidade.nome instead of string field. Handle null/undefined cases gracefully with fallback text. Ensure no breaking changes in existing views.",
      "acceptance_criteria": [
        "All corpo_clinico queries updated to join especialidades table",
        "Web app tables/lists display especialidade.nome correctly",
        "Web app detail/profile views display especialidade.nome correctly",
        "Mobile app lists/cards display especialidade.nome correctly",
        "Mobile app detail/profile screens display especialidade.nome correctly",
        "Null/undefined especialidade handled with appropriate fallback (e.g., 'Não especificado')"
      ],
      "passes": true
    },
    {
      "id": "F008",
      "title": "Remove deprecated especialidade string column and update tests",
      "type": "refactoring",
      "description": "After verifying all functionality works with especialidade_id: Create migration to drop old 'especialidade' string column from corpo_clinico table. Remove any remaining references to the old field in codebase. Update or create unit/integration tests for forms, queries, and display components to verify especialidade selection and display. Test edge cases like missing especialidades, form validation, and data migration scenarios. Document the refactoring in README or migration notes.",
      "acceptance_criteria": [
        "Migration created to safely drop 'especialidade' string column",
        "All code references to old especialidade string field removed",
        "Unit tests created/updated for web forms with especialidade Select",
        "Unit tests created/updated for mobile forms with especialidade Picker",
        "Integration tests verify correct data flow from selection to display",
        "Documentation updated explaining the especialidade refactoring"
      ],
      "passes": true
    },
    {
      "id": "F009",
      "title": "Investigate and document Calendário de Escalas current implementation",
      "type": "feature",
      "description": "Analyze the current calendar component implementation to understand the filter functionality issues. Document the component structure, identify which filters are broken (Hoje/Anterior/Próximo navigation, dezembro 2025 month selector, Mês/Semana/Dia/Agenda view switcher), locate the relevant files in the project structure, and identify the root causes of the filtering issues. Create a technical summary of findings.",
      "acceptance_criteria": [
        "Calendar component files located and documented",
        "All broken filter functionalities identified and catalogued",
        "Root causes of filter issues documented",
        "Current state vs expected behavior clearly described",
        "Technical summary created with fix recommendations"
      ],
      "passes": true
    },
    {
      "id": "F010",
      "title": "Fix Hoje/Anterior/Próximo date navigation controls",
      "type": "feature",
      "description": "Repair the date navigation controls that allow users to jump to today, previous period, or next period in the calendar. Ensure proper state management for current date selection, implement correct date calculation logic using date-fns, and verify navigation works correctly across all view modes (Mês/Semana/Dia/Agenda). Add proper event handlers and state updates.",
      "acceptance_criteria": [
        "Hoje button correctly navigates to current date",
        "Anterior button moves to previous period based on current view",
        "Próximo button moves to next period based on current view",
        "Date state properly updates and reflects in calendar UI",
        "Navigation works correctly in all view modes"
      ],
      "passes": false
    },
    {
      "id": "F011",
      "title": "Fix month/year selector (dezembro 2025) functionality",
      "type": "feature",
      "description": "Repair the month and year selection controls that allow users to pick specific months and years. Implement proper onChange handlers, ensure state synchronization between selector and calendar display, add proper date validation, and verify the calendar correctly renders events for the selected month/year. Use date-fns for date manipulation.",
      "acceptance_criteria": [
        "Month selector dropdown functions correctly",
        "Year selector dropdown functions correctly",
        "Selected month/year properly updates calendar display",
        "Calendar events load correctly for selected period",
        "Date state remains consistent across component"
      ],
      "passes": false
    },
    {
      "id": "F012",
      "title": "Fix view mode switcher (Mês/Semana/Dia/Agenda)",
      "type": "feature",
      "description": "Repair the view mode toggle controls that switch between Month, Week, Day, and Agenda views. Implement proper view state management, ensure each view mode renders correctly with appropriate layout and event display, handle date range calculations for each view type, and maintain selected date when switching between views. Utilize React Big Calendar or custom view components.",
      "acceptance_criteria": [
        "Mês (Month) view renders correctly with all dates",
        "Semana (Week) view shows correct 7-day range",
        "Dia (Day) view displays single day with hourly breakdown",
        "Agenda view shows list of upcoming events",
        "View switching maintains current date selection"
      ],
      "passes": false
    },
    {
      "id": "F013",
      "title": "Integrate all calendar filters and verify complete functionality",
      "type": "feature",
      "description": "Ensure all calendar filters work together harmoniously. Test interactions between date navigation, month/year selector, and view mode switcher. Verify state management is consistent across all filter types, fix any race conditions or state conflicts, ensure URL parameters or local state persist user selections, and validate calendar performance with multiple filters active.",
      "acceptance_criteria": [
        "All filters work together without conflicts",
        "Changing one filter doesn't break others",
        "Calendar state persists correctly during filter changes",
        "No console errors or warnings during filter usage",
        "Calendar renders correctly with any filter combination"
      ],
      "passes": false
    },
    {
      "id": "F014",
      "title": "Create Playwright e2e test setup with authentication",
      "type": "feature",
      "description": "Set up Playwright testing framework for the web application. Configure Playwright with proper TypeScript support, create authentication helper that logs in with provided credentials (ths.pereira@gmail.com / Qsesbs2006), implement session storage to avoid repeated logins, create base test fixtures and page objects for calendar testing, and configure test environment variables.",
      "acceptance_criteria": [
        "Playwright installed and configured in apps/web",
        "Authentication helper successfully logs in test user",
        "Session state is reused across tests",
        "Base fixtures and page objects created for calendar",
        "Test configuration file created with proper settings"
      ],
      "passes": false
    },
    {
      "id": "F015",
      "title": "Write e2e tests for date navigation controls",
      "type": "feature",
      "description": "Create comprehensive Playwright e2e tests for Hoje/Anterior/Próximo navigation controls. Test clicking Hoje button navigates to current date, test Anterior/Próximo buttons navigate correctly in each view mode, verify date display updates correctly, test edge cases like month/year boundaries, and ensure tests run reliably with proper waits and assertions.",
      "acceptance_criteria": [
        "Test suite covers Hoje button navigation",
        "Test suite covers Anterior button in all views",
        "Test suite covers Próximo button in all views",
        "Edge cases tested (month boundaries, year transitions)",
        "All tests pass consistently with proper assertions"
      ],
      "passes": false
    },
    {
      "id": "F016",
      "title": "Write e2e tests for month/year selector and view modes",
      "type": "feature",
      "description": "Create comprehensive Playwright e2e tests for month/year selection and view mode switching. Test selecting different months and years updates calendar correctly, test switching between Mês/Semana/Dia/Agenda views, verify events display correctly in each view, test combined filter scenarios, and ensure all tests have proper assertions and error handling.",
      "acceptance_criteria": [
        "Tests verify month selector functionality",
        "Tests verify year selector functionality",
        "Tests verify all 4 view modes render correctly",
        "Tests verify events display in each view mode",
        "Combined filter scenarios tested successfully"
      ],
      "passes": false
    },
    {
      "id": "F017",
      "title": "Add calendar e2e tests to CI/CD and document test usage",
      "type": "feature",
      "description": "Integrate Playwright calendar tests into the project's CI/CD pipeline. Update package.json with test scripts, configure test running in GitHub Actions or similar CI, create test documentation explaining how to run tests locally and in CI, document the test user credentials management approach, and ensure tests run in headless mode for CI while supporting headed mode for debugging.",
      "acceptance_criteria": [
        "Test scripts added to package.json (test:e2e, test:e2e:ui)",
        "CI/CD pipeline configured to run calendar tests",
        "README or docs updated with test running instructions",
        "Test credentials securely managed (env vars/secrets)",
        "Tests successfully run in both local and CI environments"
      ],
      "passes": false
    }
  ]
}